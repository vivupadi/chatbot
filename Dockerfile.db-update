# Dockerfile cronjob and automatic chromadb update

FROM python:3.11-slim

WORKDIR /app

# Install dependencies (this layer is cached)
RUN pip install --no-cache-dir \
    azure-storage-blob \
    chromadb \
    langchain \
    langchain-community \
    sentence-transformers \
    beautifulsoup4 \
    PyPDF2 \
    pypdf \
    requests \
    lxml

# Copy only required files, preserving src/ package structure
RUN mkdir -p src/data src/utils && \
    touch src/__init__.py src/data/__init__.py src/utils/__init__.py
COPY src/data/ingestion.py src/data/
COPY src/data/vectorstore.py src/data/
COPY src/utils/config.py src/utils/

# Default command runs both scripts as modules
CMD ["bash", "-c", "python3 -m src.data.ingestion && python3 -m src.data.vectorstore"]